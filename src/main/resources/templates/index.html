<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Clothing Store · Home</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background:#f8fafc }
        .card { border:0; border-radius:1rem; box-shadow:0 10px 25px rgba(0,0,0,.05) }
        .hero { background:linear-gradient(135deg,#eef2ff 0%,#f8fafc 100%); border-radius:1.25rem; padding:3rem 2rem }
        .product-img { aspect-ratio: 4 / 3; object-fit: cover; background:#e9ecef; border-top-left-radius:1rem; border-top-right-radius:1rem }
    </style>
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg bg-white border-bottom">
    <div class="container">
        <a class="navbar-brand fw-semibold" th:href="@{/}">Clothing Store</a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#topnav">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div id="topnav" class="collapse navbar-collapse">
            <ul class="navbar-nav me-auto">
                <li class="nav-item"><a class="nav-link" th:href="@{/}">Home</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/products}">Products</a></li>
                <li class="nav-item" sec:authorize="isAuthenticated()"><a class="nav-link" th:href="@{/orders}">My Orders</a></li>
                <li class="nav-item" sec:authorize="hasRole('ADMIN')"><a class="nav-link" th:href="@{/admin/statistics}">Statistics</a></li>
            </ul>

            <!-- Cart + Auth -->
            <ul class="navbar-nav align-items-lg-center gap-2 ms-auto">
                <li class="nav-item" sec:authorize="isAuthenticated()">
                    <a class="btn btn-outline-primary position-relative" th:href="@{/cart}">
                        Cart
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-primary"
                              th:text="${cartCount} ?: 0">0</span>
                    </a>
                </li>

                <li class="nav-item d-flex align-items-center gap-2" sec:authorize="!isAuthenticated()">
                    <a class="btn btn-outline-secondary" th:href="@{/login}">Login</a>
                    <a class="btn btn-primary" th:href="@{/register}">Register</a>
                </li>

                <li class="nav-item d-flex align-items-center gap-3" sec:authorize="isAuthenticated()">
                    <span class="text-secondary small">Signed in as <strong th:text="${#authentication.name}">user@example.com</strong></span>
                    <form th:action="@{/logout}" method="post" class="m-0">
                        <div th:insert="~{fragments/csrf :: csrf}"></div>
                        <button class="btn btn-outline-danger btn-sm" type="submit">Logout</button>
                    </form>
                </li>
            </ul>
        </div>
    </div>
</nav>

<!-- HERO -->
<main class="container py-5">
    <section class="hero mb-5">
        <div class="row align-items-center">
            <div class="col-lg-7">
                <h1 class="display-6 fw-semibold mb-3">Fresh styles. Fast checkout.</h1>
                <p class="lead text-secondary mb-4">
                    Browse new arrivals, add to cart in one click, and track your orders. Admins get live sales stats.
                </p>
                <div class="d-flex flex-wrap gap-2">
                    <a th:href="@{/products}" class="btn btn-primary btn-lg">Browse Products</a>
                    <a th:href="@{/register}" class="btn btn-outline-primary btn-lg" sec:authorize="!isAuthenticated()">Create Account</a>
                    <a th:href="@{/admin/statistics}" class="btn btn-outline-secondary btn-lg" sec:authorize="hasRole('ADMIN')">View Statistics</a>
                </div>
            </div>
            <div class="col-lg-5 mt-4 mt-lg-0">
                <div class="card p-4">
                    <h2 class="h5 mb-3">Quick status</h2>
                    <ul class="list-unstyled mb-0 small text-secondary">
                        <li sec:authorize="isAuthenticated()">Role:
                            <span class="badge bg-success ms-1" sec:authorize="hasRole('USER')">USER</span>
                            <span class="badge bg-dark ms-1" sec:authorize="hasRole('ADMIN')">ADMIN</span>
                        </li>
                        <li sec:authorize="!isAuthenticated()">You’re browsing as a guest.</li>
                        <li>Cart items: <strong th:text="${cartCount} ?: 0">0</strong></li>
                        <li>Stack: Spring Boot · JDBC · PostgreSQL · Thymeleaf · Bootstrap</li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <!-- FEATURED PRODUCTS WITH ADD-TO-CART -->
    <section class="mb-4">
        <div class="d-flex align-items-center mb-3">
            <h2 class="h5 mb-0">Featured products</h2>
            <a class="ms-auto small text-decoration-none" th:href="@{/products}">See all</a>
        </div>

        <div class="row g-4">
            <div class="col-sm-6 col-lg-4" th:each="p : ${products}">
                <div class="card h-100">
                    <img class="product-img" th:src="${p.imageUrl} ?: @{/images/placeholder.png}" alt="Product image">
                    <div class="card-body d-flex flex-column">
                        <h3 class="h6 mb-1" th:text="${p.name}">Product Name</h3>
                        <p class="text-secondary small flex-grow-1" th:text="${p.description} ?: ''"></p>
                        <div class="d-flex align-items-center justify-content-between">
                            <span class="fw-semibold" th:text="${#numbers.formatDecimal(p.price,1,2)}">$0.00</span>

                            <!-- Add to cart (auth only) -->
                            <form th:action="@{/cart/add}" method="post" class="d-flex align-items-center gap-2" sec:authorize="isAuthenticated()">
                                <div th:insert="~{fragments/csrf :: csrf}"></div>
                                <input type="hidden" name="productId" th:value="${p.productId} ?: ${p.id}">
                                <input class="form-control form-control-sm" style="width:80px" type="number" name="qty" min="1" value="1">
                                <button class="btn btn-primary btn-sm" type="submit">Add</button>
                            </form>

                            <!-- Prompt login (guests) -->
                            <a class="btn btn-outline-secondary btn-sm" th:href="@{/login}" sec:authorize="isAnonymous()">Login to add</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Empty state -->
            <div class="col-12" th:if="${#lists.isEmpty(products)}">
                <div class="alert alert-light border text-secondary">No products yet. Check back soon.</div>
            </div>
        </div>
    </section>

    <!-- FEATURE CARDS -->
    <section>
        <div class="row g-4">
            <div class="col-md-4">
                <div class="card h-100 p-4">
                    <h3 class="h5">Registration & Login</h3>
                    <p class="text-secondary mb-4">Secure authentication with role-based content.</p>
                    <div class="d-flex gap-2">
                        <a th:href="@{/register}" class="btn btn-outline-primary" sec:authorize="!isAuthenticated()">Register</a>
                        <a th:href="@{/login}" class="btn btn-outline-secondary" sec:authorize="!isAuthenticated()">Login</a>
                        <a th:href="@{/logout}" class="btn btn-outline-danger" sec:authorize="isAuthenticated()">Logout</a>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card h-100 p-4">
                    <h3 class="h5">Shop & Orders</h3>
                    <p class="text-secondary mb-4">Browse products, manage your cart, and review order history.</p>
                    <div class="d-flex gap-2">
                        <a th:href="@{/products}" class="btn btn-outline-primary">Products</a>
                        <a th:href="@{/orders}" class="btn btn-outline-secondary" sec:authorize="isAuthenticated()">My Orders</a>
                    </div>
                </div>
            </div>

            <div class="col-md-4" sec:authorize="hasRole('ADMIN')">
                <div class="card h-100 p-4">
                    <h3 class="h5">Admin Statistics</h3>
                    <p class="text-secondary mb-4">Top sellers, monthly revenue, low stock, and more.</p>
                    <a th:href="@{/admin/statistics}" class="btn btn-outline-dark">Open Dashboard</a>
                </div>
            </div>
        </div>
    </section>
</main>

<!-- FOOTER -->
<footer class="border-top bg-white py-3 mt-5">
    <div class="container text-center text-secondary small">
        © <span th:text="${#dates.format(#dates.createNow(),'yyyy')}">2025</span> Clothing Store · Built with Spring Boot & PostgreSQL
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
